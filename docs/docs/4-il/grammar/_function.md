---
sidebar_position: 5
title: 函数
---

函数是一种特殊的列表，同时整个程序也可以看做一个特殊的函数

函数的创建有4种方式，使用`def`，`fn`，`lambda`，或者直接创建列表

```
# def
def prn
    print \_
# fn
prn = (fn print \_)
# lambda
prn = (lambda (print \_))
# 直接创建列表
prn = `(lambda ((print \_)))
```
> 注释: `#`
>
> ```
> ;<内容，从分号到这一行末尾都被视为注释内容>
> #<内容，同上>
> ```

> 赋值: `=`
>
> 进行类似 python 的打包解包，在中间的形式是语法糖
>
> 放在开头时接收 2 个元素
>
> 放在中间时接收两边的元素放进2个列表里变成第一种形式
>
> 返回被赋的值，例如有多个则返回列表
>
> ```
> (= <容器> <值>)
> (<容器1> <容器2> ... = <值1> <值2> ...)
> ```

> 特殊quote: `` ` ``
>
> 与正常的quote不同，这个quote会递归遍历其内的所有值，读取但是不求值，`` ` ``是语法糖
>
> 用处和格式化字符串一样，当遇到`_`，`:`，`\`时，进行特殊的操作
>
> 第一项包括`_`，`__`，`_<i>`，会从局部变量读取函数参数(如果有)，在下面会详细介绍
>
> 第二项，意味着立即进行求值
>
> 第三项，将会去掉一层`\`，然后把其中的内容放回原处
>
> 调用`def`，`fn`和`lambda`时会触发`特殊quote`
>
> ```
> (squote <表达式>)
> `<表达式>
> ```

`def`和`fn`都是调用的`lambda`

```
macro lambda
    `(lambda \__)
macro def
    \_ = (lambda \__)
macro fn
    lambda (\__)
```

> 宏: `macro`
>
> 感觉可以用来定义像是内置操作符一样酷酷的东西，其参数的输入和函数一样
>
> ```
> (macro <名字> <内容>)
> ```

> 解包: `*`
>
> 用以解包可迭代对象，`*`是语法糖
>
> 比如把(f *(a b c))变成(f a b c)
>
> ```
> (<- <可迭代对象>)
> *<可迭代对象>
> ```

> 参数列表: `__`
>
> `_`是迭代读取参数列表，每读取一次都是上一次的下一位，若没有参数可读取，返回`nil`
>
> `__`接收局部变量中没有被`_`读取的剩余参数列表，并且自动解包
>
> `__args__`为获取目前的参数列表
>
> `_<i>`为按照索引读取参数列表，是`(__args__ <i>)`的语法糖
>
> 若直接使用类似"`_`"的形式而不加转义(`\`)，则会读取整个程序的参数列表，即命令行后面的参数(将整个程序作为一个函数)

当函数作为头时，创建局部变量(压栈)并在其中设置参数变量，然后依次求值并返回最后一项

当嵌套函数时，叠的转义(`\`)越多，则在越深的函数调用时被解析

```
# 最基本的装饰器，返回一个和原有函数行为一致的新函数(除了多了一层调用栈之外)
lambda
    lambda
        \_ \\__
# 将一个函数的参数输入分成2次
lambda
    lambda
        lambda
            \_ \\__ \\\__
```

函数中使用`__self__`指定自身，或者使用`:`就地绑定

```
# 阶乘函数
def fact
    (in _0 [0 1])
        1
        * _0 (:fact (- _0))
```

> `in`类似 python，返回 bool 值

> `[]`是`list`的语法糖，依次解析每一项后返回列表

> 当 bool 值在表达式第一项时，若为`True`，返回第二项，否则返回第三项

> `(1)` 返回 `1`

> `-`在仅有一个元素时，默认减一...`+`同理

不定义函数，可以直接搬运代码块

```
a = '(+ i)
while (< i 10)
    eval a
print i
```

> quote: `'`
>
> 如同字符串的引号将列表框住，与特殊quote不同的是并不会在意被框起来的一切
>
> ```
> (quote <表达式>)
> '<表达式>
> ```

> eval: `eval`
>
> 将列表作为代码运行
>
> ```
> (eval <表达式>)
> .<表达式>
> ```

